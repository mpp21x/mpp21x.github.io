<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>LeetCode 訓練(3) - Group the People Given the Group Size They Belong To</title>
      <link href="/2020/05/10/2020/leetcode-1282/"/>
      <url>/2020/05/10/2020/leetcode-1282/</url>
      
        <content type="html"><![CDATA[<ul><li>link：<a href="https://leetcode.com/problems/group-the-people-given-the-group-size-they-belong-to/" target="_blank" rel="noopener">Group the People Given the Group Size They Belong To</a></li><li>difficulty：<code>medium</code></li><li>language：<code>javascript</code></li></ul><h2 id="題目講解">題目講解</h2><p>There are n people whose IDs go from 0 to n - 1 and each person belongs exactly to one group. Given the array groupSizes of length n telling the group size each person belongs to, return the groups there are and the people's IDs each group includes.</p><p>You can return any solution in any order and the same applies for IDs. Also, it is guaranteed that there exists at least one solution.</p><p>Example 1:</p><pre><code>Input: groupSizes = [3,3,3,3,3,1,3]Output: [[5],[0,1,2],[3,4,6]]Explanation: Other possible solutions are [[2,1,6],[5],[0,4,3]] and [[5],[0,6,2],[4,3,1]].</code></pre><p>Example 2:</p><pre><code>Input: groupSizes = [2,1,3,3,3,2]Output: [[1],[0,5],[2,3,4]]</code></pre><p>Constraints:</p><ul><li><code>groupSizes.length == n</code></li><li><code>1 &lt;= n &lt;= 500</code></li><li><code>1 &lt;= groupSizes[i] &lt;= n</code></li></ul><h3 id="題目解釋">題目解釋</h3><p>給予一個充滿整數的陣列 <code>groupSizes</code>，這個陣列每一個整數都代表一個人其所屬的群組人數，而我們要做的便是給予每一個人 ID (從 0 到 <code>n-1</code>)，以及按任何順序歸類在同一個群組。</p><p>總之，最後要回傳一個二維陣列，陣列中的每一個陣列元素代表其群組，裡面必須包含每個人的 ID。</p><h2 id="題目解析思路">題目解析思路</h2><p>我們要做的有以下幾個步驟：</p><ol type="1"><li><strong>遍歷取出數字</strong>： <code>for</code> 遍歷 <code>groupSizes</code>，取出 <code>groupSize</code></li><li><strong>將 ID 放至群組</strong>：將 For 迴圈的 <code>index</code> 作為每個人的 ID，放到各自所屬的一個變數 <code>tempGroup</code></li><li><strong>暫存尚未湊滿 groupSize 的 group</strong>：在上述的步驟 2 當中，變數 <code>tempGroup</code> 若尚未湊滿其應有的 <code>groupSize</code>，便不應該將其放至 <code>ans</code>，這時可以先準備一個 <code>tempGroups</code> 暫存這些 <code>tempGroup</code>，之後每次新增人數時以及將 <code>tempGroup</code> 放入 <code>ans</code> ，也優先從這裡取出。</li><li><strong>將群組放在最後欲回傳的變數</strong>：確認 <code>tempGroup</code> 人數是否湊滿，湊滿的話，便將其集合到一個陣列變數 <code>ans</code> 最後將此二維陣列回傳即可。</li></ol><h2 id="實作程式碼">實作程式碼</h2><div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">/**</span></span><span id="cb3-2"><a href="#cb3-2"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{number</span><span class="co">[]} groupSizes</span></span><span id="cb3-3"><a href="#cb3-3"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> {number[][]}</span></span><span id="cb3-4"><a href="#cb3-4"></a><span class="co"> */</span></span><span id="cb3-5"><a href="#cb3-5"></a><span class="kw">var</span> groupThePeople <span class="op">=</span> <span class="kw">function</span> (groupSizes) {</span><span id="cb3-6"><a href="#cb3-6"></a></span><span id="cb3-7"><a href="#cb3-7"></a>    <span class="kw">const</span> sizesLength <span class="op">=</span> groupSizes<span class="op">.</span><span class="at">length</span><span class="op">;</span></span><span id="cb3-8"><a href="#cb3-8"></a>    <span class="kw">const</span> tempGroups <span class="op">=</span> {}<span class="op">;</span></span><span id="cb3-9"><a href="#cb3-9"></a>    <span class="kw">const</span> ans <span class="op">=</span> []<span class="op">;</span></span><span id="cb3-10"><a href="#cb3-10"></a></span><span id="cb3-11"><a href="#cb3-11"></a>    <span class="co">// 1. 遍歷取出數字</span></span><span id="cb3-12"><a href="#cb3-12"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> sizesLength<span class="op">;</span> i<span class="op">++</span>) {</span><span id="cb3-13"><a href="#cb3-13"></a>        <span class="kw">let</span> groupSize <span class="op">=</span> groupSizes[i]<span class="op">;</span></span><span id="cb3-14"><a href="#cb3-14"></a>        <span class="kw">let</span> tempGroup <span class="op">=</span> []<span class="op">;</span></span><span id="cb3-15"><a href="#cb3-15"></a>        <span class="co">// 3. 暫存尚未湊滿 groupSize 的 group</span></span><span id="cb3-16"><a href="#cb3-16"></a>        <span class="cf">if</span> (tempGroups<span class="op">.</span><span class="fu">hasOwnProperty</span>(groupSize)) {</span><span id="cb3-17"><a href="#cb3-17"></a>            tempGroup <span class="op">=</span> tempGroups[groupSize]<span class="op">;</span></span><span id="cb3-18"><a href="#cb3-18"></a>        }</span><span id="cb3-19"><a href="#cb3-19"></a>        <span class="co">// 2. 將 ID 放至群組</span></span><span id="cb3-20"><a href="#cb3-20"></a>        tempGroup<span class="op">.</span><span class="fu">push</span>(i)<span class="op">;</span></span><span id="cb3-21"><a href="#cb3-21"></a>        tempGroups[groupSize] <span class="op">=</span> tempGroup<span class="op">;</span></span><span id="cb3-22"><a href="#cb3-22"></a>        <span class="co">// 4. 將群組放在最後欲回傳的變數</span></span><span id="cb3-23"><a href="#cb3-23"></a>        <span class="cf">if</span> (tempGroup<span class="op">.</span><span class="at">length</span> <span class="op">===</span> groupSize) {</span><span id="cb3-24"><a href="#cb3-24"></a>            ans<span class="op">.</span><span class="fu">push</span>(tempGroup)<span class="op">;</span></span><span id="cb3-25"><a href="#cb3-25"></a>            <span class="kw">delete</span> tempGroups[groupSize]<span class="op">;</span></span><span id="cb3-26"><a href="#cb3-26"></a>        }</span><span id="cb3-27"><a href="#cb3-27"></a>    }</span><span id="cb3-28"><a href="#cb3-28"></a></span><span id="cb3-29"><a href="#cb3-29"></a>    <span class="cf">return</span> ans<span class="op">;</span></span><span id="cb3-30"><a href="#cb3-30"></a>}<span class="op">;</span></span></code></pre></div><h2 id="其他">其他</h2><h3 id="github-紀錄">GitHub 紀錄</h3><p>此次練習被收錄在我的 GitHub <a href="https://github.com/mpp21x/algorithm-exercise/tree/master/1282.Group-the-People-Given-the-Group-Size-They-Belong-To" target="_blank" rel="noopener">點我連結</a>。</p>]]></content>
      
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> javascript </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 訓練(2) -  Kids With the Greatest Number of Candies</title>
      <link href="/2020/05/06/2020/leetcode-1431-kids-with-the-greatest-number-of-candies/"/>
      <url>/2020/05/06/2020/leetcode-1431-kids-with-the-greatest-number-of-candies/</url>
      
        <content type="html"><![CDATA[<ul><li>link：<a href="https://leetcode.com/problems/kids-with-the-greatest-number-of" target="_blank" rel="noopener">Kids With the Greatest Number of Candies</a></li><li>difficulty：<code>easy</code></li><li>language：<code>javascript</code></li></ul><h2 id="題目講解">題目講解</h2><h3 id="原文">原文</h3><p>Given the array candies and the integer extraCandies, where candies[i] represents the number of candies that the ith kid has.</p><p>For each kid check if there is a way to distribute extraCandies among the kids such that he or she can have the greatest number of candies among them. Notice that multiple kids can have the greatest number of candies.</p><p>Example 1:</p><pre><code>Input: candies = [2,3,5,1,3], extraCandies = 3Output: [true,true,true,false,true] Explanation: Kid 1 has 2 candies and if he or she receives all extra candies (3) will have 5 candies --- the greatest number of candies among the kids. Kid 2 has 3 candies and if he or she receives at least 2 extra candies will have the greatest number of candies among the kids. Kid 3 has 5 candies and this is already the greatest number of candies among the kids. Kid 4 has 1 candy and even if he or she receives all extra candies will only have 4 candies. Kid 5 has 3 candies and if he or she receives at least 2 extra candies will have the greatest number of candies among the kids. </code></pre><p>Example 2:</p><pre><code>Input: candies = [4,2,1,1,2], extraCandies = 1Output: [true,false,false,false,false] Explanation: There is only 1 extra candy, therefore only kid 1 will have the greatest number of candies among the kids regardless of who takes the extra candy.</code></pre><p>Example 3:</p><pre><code>Input: candies = [12,1,12], extraCandies = 10Output: [true,false,true]</code></pre><p>Constraints:</p><ul><li><code>2 &lt;= candies.length &lt;= 100</code></li><li><code>1 &lt;= candies[i] &lt;= 100</code></li><li><code>1 &lt;= extraCandies &lt;= 50</code></li></ul><h3 id="題目解釋">題目解釋</h3><p>給予一個充滿整數的陣列 <code>candies</code> 以及一個指定的整數 <code>extraCandies</code>，我們需要取出 <code>candies</code> 中的每一個整數，再加上 <code>extraCandies</code> 之後，判斷其是否大於或等於 <code>candies</code> 中最大的那個數字，若是則為 <code>true</code> 否則為 <code>false</code>。</p><p>再將每一個整數的運算結果放在一個陣列後回傳，也就是說必須回傳一個與 <code>candies</code> 同等長度以及皆為 boolean 值的陣列。</p><h2 id="題目解析思路">題目解析思路</h2><p>這題大致可以幾個步驟（數字為代稱，不一定為實際順序）：</p><ol type="1"><li><strong>遍歷取出數字</strong>：將 <code>candies</code> 一一取出。這一步驟讓時間複雜度至少會是 <code>O(n)</code>。</li><li><strong>運算及比較</strong>： 加上 <code>extraCandies</code> 之後進行比較。</li><li><strong>找出最大值</strong>： 找出 <code>candies</code> 最大的數值。</li></ol><p>這裡的 <strong>步驟 1</strong> 和 <strong>步驟 2</strong> ，在邏輯上必然有先後關聯的，可將步驟 1 和 步驟 2 可視為一體，而接下來則是思考 要先 <strong>步驟 3</strong> 或是 <strong>步驟 1 &amp; 2</strong>：</p><p>若先執行 <strong>步驟 1 &amp; 2</strong> -&gt; <strong>步驟 3</strong>，這樣一邊遍歷取出元素 又得重複尋找出最大值，時間複雜度為 <code>O(n²)</code></p><p>如果先 <strong>步驟 3</strong> -&gt; <strong>步驟 1 &amp; 2</strong>，一開始就找出最大數，時間複雜度為 <code>2n</code> 而已。</p><h2 id="實作程式碼">實作程式碼</h2><p>將上述過程轉化程式碼便是如下：</p><div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">var</span> kidsWithCandies <span class="op">=</span> <span class="kw">function</span> (candies<span class="op">,</span> extraCandies) {</span><span id="cb4-2"><a href="#cb4-2"></a>    <span class="co">// 3. 找出最大值</span></span><span id="cb4-3"><a href="#cb4-3"></a>    <span class="kw">const</span> maxNum <span class="op">=</span> candies<span class="op">.</span><span class="fu">reduce</span>((accumulator<span class="op">,</span> currentValue) <span class="kw">=&gt;</span> {</span><span id="cb4-4"><a href="#cb4-4"></a>        <span class="cf">return</span> currentValue <span class="op">&gt;</span> accumulator <span class="op">?</span> currentValue <span class="op">:</span> accumulator<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5"></a>    }<span class="op">,</span> candies[<span class="dv">0</span>])<span class="op">;</span></span><span id="cb4-6"><a href="#cb4-6"></a></span><span id="cb4-7"><a href="#cb4-7"></a>    <span class="kw">const</span> answer <span class="op">=</span> []<span class="op">;</span></span><span id="cb4-8"><a href="#cb4-8"></a></span><span id="cb4-9"><a href="#cb4-9"></a>    <span class="kw">const</span> length <span class="op">=</span> candies<span class="op">.</span><span class="at">length</span><span class="op">;</span></span><span id="cb4-10"><a href="#cb4-10"></a>    <span class="co">// 1. 遍歷取出數字 以及 2. 運算及比較</span></span><span id="cb4-11"><a href="#cb4-11"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> length<span class="op">;</span> i<span class="op">++</span>) {</span><span id="cb4-12"><a href="#cb4-12"></a>        answer<span class="op">.</span><span class="fu">push</span>((candies[i] <span class="op">+</span> extraCandies) <span class="op">&gt;=</span> maxNum)<span class="op">;</span></span><span id="cb4-13"><a href="#cb4-13"></a>    }</span><span id="cb4-14"><a href="#cb4-14"></a></span><span id="cb4-15"><a href="#cb4-15"></a>    <span class="cf">return</span> answer<span class="op">;</span></span><span id="cb4-16"><a href="#cb4-16"></a>}<span class="op">;</span></span></code></pre></div><h2 id="其他">其他</h2><h3 id="github-紀錄">GitHub 紀錄</h3><p>此次練習被收錄在我的 GitHub <a href="https://github.com/mpp21x/algorithm-exercise/tree/master/1431.Kids_With_the_Greatest_Number_of_Candies" target="_blank" rel="noopener">點我連結</a>。</p>]]></content>
      
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> javascript </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode 訓練(1) - Two Sum (JS/Easy)</title>
      <link href="/2020/05/06/2020/leetcode-1-two-sum/"/>
      <url>/2020/05/06/2020/leetcode-1-two-sum/</url>
      
        <content type="html"><![CDATA[<ul><li>link：<a href="https://leetcode.com/problems/two-sum/" target="_blank" rel="noopener">Two Sum</a></li><li>difficulty：<code>easy</code></li><li>language：<code>javascript</code></li></ul><h2 id="題目講解">題目講解</h2><h3 id="原文">原文</h3><p>Given an array of integers, return indices of the two numbers such that they add up to a specific target.</p><p>You may assume that each input would have exactly one solution, and you may not use the same element twice.</p><p>Example:</p><pre><code>Given nums = [2, 7, 11, 15], target = 9,Because nums[0] + nums[1] = 2 + 7 = 9,return [0, 1].</code></pre><h3 id="題目解釋">題目解釋</h3><p>給予一個數列 <code>nums</code> 以及一個指定的整數 <code>target</code>，我們必須找出在這個陣列中的某兩個數，其總和 必然與 <code>target</code> 相等，並將此二數的索引值放在一個陣列之後回傳出去。</p><p>另外，在陣列中，必然只有兩個數的總和跟 <strong>指定的整數</strong> 一樣，同時這兩個數必然是不同的數，不能為同一個數。</p><p>舉例來說：</p><p><code>nums</code> 為 <code>[2, 7, 11, 15]</code>，而 <code>target</code> 為 <code>9</code>，因為 <code>nums[0]</code> 以及 <code>nums[1]</code> 總和為 <code>9</code> 跟 <code>target</code> 一樣，所以答案就是 <code>[0, 1]</code>。</p><h2 id="題目解析思路">題目解析思路</h2><h3 id="線索-1-target">線索 1 <code>Target</code></h3><p>首先我們知道，答案的兩個數總和（假設叫做 <code>a</code> 和 <code>b</code>），與 <code>target</code> 同等，透過簡單的推理可得知：</p><pre><code>target = a + btraget - a = b target - b = a </code></pre><p>我們可以透過 <code>target</code> 減去 <code>nums</code> 任一的數字，來得到另一個餘數，倘若此二數皆存在於 <code>nums</code> ，那就是我們想要找的答案 <code>a</code> 與 <code>b</code>。</p><p>所以答案必然是透過 <code>target</code> 進行加減的運算可得出。</p><h3 id="線索-2-流程">線索 2 流程</h3><p>由於要得到答案，流程必然經過這幾個步驟，讓我們先給這三個步驟一個代稱，以便後續稱呼：</p><ol type="1"><li><p><strong>遍歷步驟</strong>：也就是一一取出 nums 的每一個數字，這一步驟讓時間複雜度至少會是 <code>O(n)</code>。</p></li><li><p><strong>取得待確認值步驟</strong>：取出 nums 的一個數字後，使用 <code>target</code> 減去此數的餘數，再來確認是否存在於 <code>nums</code>，即可。</p></li><li><p><strong>確認餘數是否存在於 nums </strong>： 再來就是使用餘數，來確認是否存在於 <code>nums</code> ，且不能為同一 index，這個是這一題比較重要的環節，目前想到有兩種思路：</p><p>3.1. <strong>遍歷搜尋</strong> 針對 <code>nums</code> 目前所運算到的位置之後的陣列，使用 <code>indexOf</code> 的方式來找出答案</p><p>3.2 <strong>暫存 map 搜尋</strong> 將每次運算暫存於自定義的變數 <code>map</code>，搜尋時也一律從 <code>map</code> 當中搜尋。</p></li></ol><p>再來針對我們的 3.1 和 3.2 這兩種搜尋做解釋。</p><ul><li><p>3-1. 遍歷搜尋 最直覺的作法便是這個了，只要用餘數去搜尋是否存在於當前所遍歷的位置，之後剩餘的數，即可找到答案，但這樣子的做法，時間複雜度會近似於 <code>O(n²)</code> 了。</p></li><li><p>3.2. 暫存 map 搜尋</p></li></ul><p>每一次遍歷運算的時候，把待確認值放在一個變數 <code>map</code>，將待確認值作為 <code>key</code>，而 Index 作為 <code>value</code> ，每次運算完之後，都將運算結果儲存到這個 <code>map</code> 裡面。</p><p>當今天運算到 <code>b</code> 的時候，由於 <code>a</code> 已經被存入到 <code>map</code>，<code>map[target - nums[index]]</code> 就可以輕易找出答案並回傳了，時間複雜度也是 <code>O(n)</code>了。</p><p>當然，最後不忘了要回傳的是 <code>a</code> 和 <code>b</code> 在 <code>nums</code> 的索引值。</p><h2 id="實作程式碼">實作程式碼</h2><p>很明顯的，最好的做法是使用 <strong>暫存 map 搜尋</strong>，接下來要做的，便是將上述過程轉化程式碼便是如下：</p><div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">var</span> twoSum <span class="op">=</span> <span class="kw">function</span>(nums<span class="op">,</span> target) {</span><span id="cb3-2"><a href="#cb3-2"></a>    <span class="kw">let</span> map <span class="op">=</span> {}<span class="op">;</span></span><span id="cb3-3"><a href="#cb3-3"></a>    <span class="cf">for</span> (<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>nums<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>) {</span><span id="cb3-4"><a href="#cb3-4"></a>        <span class="cf">if</span>(map[target <span class="op">-</span> nums[i]] <span class="op">&gt;</span> <span class="dv">-1</span>){</span><span id="cb3-5"><a href="#cb3-5"></a>            <span class="cf">return</span> [map[target <span class="op">-</span> nums[i]]<span class="op">,</span> i]<span class="op">;</span></span><span id="cb3-6"><a href="#cb3-6"></a>        }</span><span id="cb3-7"><a href="#cb3-7"></a>        map[nums[i]] <span class="op">=</span> i<span class="op">;</span></span><span id="cb3-8"><a href="#cb3-8"></a>    }</span><span id="cb3-9"><a href="#cb3-9"></a>}<span class="op">;</span></span><span id="cb3-10"><a href="#cb3-10"></a><span class="co">// 驗算</span></span><span id="cb3-11"><a href="#cb3-11"></a><span class="co">// console.log(twoSum([2, 7, 11, 15], 9));</span></span></code></pre></div><h2 id="其他">其他</h2><h3 id="github-紀錄">GitHub 紀錄</h3><p>此次練習被收錄在我的 GitHub <a href="https://github.com/mpp21x/algorithm-exercise/tree/master/1.twoSum" target="_blank" rel="noopener">點我連結</a>。</p><h3 id="nums-的-length">nums 的 length</h3><p>如果 <code>nums</code> 長度很大，可考慮把 <code>length</code> 塞給一個變數，避免每次都要運算陣列長度</p><h3 id="關於-3.1-遍歷搜尋-的時間複雜度運算的-on²-是怎麼算出來的">關於 <strong>3.1 遍歷搜尋</strong> 的時間複雜度運算的 <code>O(n²)</code> 是怎麼算出來的？</h3><p>假設 <code>nums</code> 長度為 3：用此搜尋在需要花到最多時間的情境下，其步驟為：</p><ul><li>取出第 1 個數字 ，比較第 2 個數字，比較第 3 個數字： 花了 3 次操作。</li><li>取出第 2 個數字 ，比較第 3 個數字： 用了 2 次操作</li><li>總共 5 次操作</li></ul><pre><code>1:2,32:3</code></pre><p>不難發現出這 5 次操作與參數 n 的關係可以用一個類似等差數列可以求得，用數學符號表示即為：</p><ul><li><code>n</code> 為項數(也就是 <code>nums</code> 的長度)</li><li><span class="math inline">\(a\mathop{}\nolimits_{1}\)</span> 為首項：固定為 1。</li><li><span class="math inline">\(a\mathop{}\nolimits_{n}\)</span> 為末項：代表 <code>nums</code> 長度，如果 <code>nums = [1,2,3]</code> 的話，則為 3。</li><li><span class="math inline">\(S\mathop{}\nolimits_{n}\)</span> 代表總耗費步驟：以 <code>nums = [1,2,3]</code> 為例的話，則是 5。</li></ul><p><span class="math inline">\(S\mathop{}\nolimits_{n}=\frac{n \left( a\mathop{}\nolimits_{1}+a\mathop{}\nolimits_{n} \right) }{2} - 1\)</span></p><p>不難發現以上公式當中，次方(或平方)最高的便是 <span class="math inline">\(n \left( a\mathop{}\nolimits_{1}+a\mathop{}\nolimits_{n} \right)\)</span> ，這個函式幾乎等同 <code>O(n²)</code> 了</p><h3 id="參考連結">參考連結：</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/105986034" target="_blank" rel="noopener">在 Hexo 博客中写出好看的Latex 公式</a><ul><li>為了要在 Hexo 用出 LaTex 公式，花了我四個小時多，找了許多篇文章設定，這篇是我覺得設定起來最好的了。</li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> javascript </tag>
            
            <tag> algorithm </tag>
            
            <tag> latex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重構實戰 &#39;GildedRose Factoring Kata &#39;</title>
      <link href="/2020/04/05/2020/gildedrose-factoring-kata/"/>
      <url>/2020/04/05/2020/gildedrose-factoring-kata/</url>
      
        <content type="html"><![CDATA[<p>這篇逐步介紹自己練習重構與 TDD 開發 Legacy Code Kata 的解題思路，題目是社群 <em>Domain Driven Design(DDD Taiwan)</em> 所舉辦的讀書會 Legacy Code 讀書會 3rd (Ch 8, 9) 所分享的重構練習題目。</p><p><strong>GildedRose Refactoring Kata</strong></p><p>另外感謝這次的講者 <em>Blues</em> 與社群用心的準備，自己蠻喜歡這次的題目，這次重構時決定嘗試做一次筆記，對自己還是很有收穫的，未來如果自己舉辦公司讀書會的話，將本題作為練習題也是非常適合。</p><ul><li><a href="https://github.com/emilybache/GildedRose-Refactoring-Kata" target="_blank" rel="noopener">GildedRose Refactoring Kata 題目程式碼來源</a></li><li><a href="https://hackmd.io/Lx84B9vHQ5irqcVhb7ebPQ?both" target="_blank" rel="noopener">講者 Blues 的題目介紹</a></li><li><a href="https://github.com/mpp21x/PHP-GildedRose-Refactoring-Kata" target="_blank" rel="noopener">本文的程式碼 Repository</a></li></ul><h5 id="legacy-code-重構前後">legacy code 重構前後</h5><figure><img src="compare_refactoring.png" alt="" /><figcaption>重構前後比較</figcaption></figure><h3 id="開發流程">開發流程</h3><ul><li>按照預期完成的測試案例項目撰寫程式碼</li><li>重構 legacy code</li><li>TDD 新增新的需求</li><li>(補充)修正測試案例五漏洞</li></ul><h2 id="題目描述">題目描述</h2><p>嗨，歡迎來到鍍金玫瑰團隊。如您所知，我們是一家小旅館，位於一線城市的黃金地段，旅館老闆是艾里森(Allison)。我們只銷售高級商品。不過每件商品都有一個銷售剩餘天數。</p><p>隨著時間的推移，商品的品質會不斷下降。</p><p>我們擁有一個可以更新庫存訊息的系統。有位名叫 River 的開發人員開發了這個系統，之後就離開了。</p><p>你的任務是將新功能添加到該系統中，以便我們可以開始銷售新種類的商品。</p><h3 id="題目原始需求">題目原始需求</h3><ol type="1"><li>所有商品(item)都有一個銷售剩餘天數(SellIn)值，表示該商品必須在該值所代表的天數內銷售出去。</li><li>所有商品都有一個品質(Quality)值，表明該商品當前的品質。</li><li>每天結束時，系統會降低每個商品的上述兩個值。</li><li>一但商品過了銷售剩餘天數之後還沒未賣出，那麼其每日品質下降的速度就會加倍。</li><li>商品的品質不能為負數。</li><li>陳年乾酪(Aged Brie)的品質值隨著時間的推移，不減反增。</li><li>商品的品質的上限為50。</li><li>魔法錘(Sulfuras)是一個傳奇商品，其銷售剩餘天數和品質都不會變化。</li><li>劇院後台通行證(Backstage passes)，就像陳年乾酪一樣，其品質會隨著銷售剩餘天數的減少而提高-當離演出開始不到10天時，品質每日提高2；當不到5天時，品質值每日提高3，當演出結束後，品質歸0。</li><li>(新需求)：魔法(Conjured)商品每日品質下降速度是正常商品的2倍</li></ol><p>在擁有系統的需求之後，首先要做的便是將消化此需求，並轉為實務開發的測試案例，有了測試案例之後，即可依照測試案例開始來撰寫測試的程式碼。</p><h3 id="預期完成的測試案例項目">預期完成的測試案例項目</h3><ol type="1"><li>原需求 3：確保一般的商品在每天結束後 ( 也就是 <code>updateQuality</code> 的 method 呼叫之後 )，系統會降低 <code>sellIn</code> 和 <code>quality</code> 兩種屬性，降低的程度由原程式碼所決定。</li><li>原需求 5：確保 <code>item</code> 的 <code>quality</code> 從不為負數</li><li>原需求 4 ：確保 <code>item</code> 的<code>sellIn</code> 為零時，若 <code>quality</code> 還不等於零，其下降速度是原本的兩倍</li><li>原需求 6：商品 Aged Brie 的物件 <code>item</code>，經過 <code>updateQuality</code> 呼叫之後，其 <code>quality</code> 不減反增，即使在 <code>sellIn</code> 歸零也是</li><li>原需求 7 ： 確保 <code>item</code> 的 <code>quality</code> 從來不超過 50</li><li>原需求 8：商品 Sulfuras 的物件 <code>item</code> ，其 <code>sellIn</code> 和 <code>quality</code> 初始化後，永久不變</li><li>原需求 9：商品 Backstage passes 的物件 <code>item</code> 須滿足下列條件：<ol type="1"><li>當 <code>sellIn</code> 為 9 到 5 的時候，<code>updateQuality</code> 一次提升 <code>quality</code> 2</li><li>當 <code>sellIn</code> 為 4 到 1 的時候，<code>updateQuality</code> 一次提升 <code>quality</code> 3</li><li>當 <code>sellIn</code> 為 0，<code>quality</code> 將直接歸零</li></ol></li><li>原需求 10 ：新增一個 Conjured 商品，<code>updateQuality</code> 所下降的值為正常商品的兩倍</li></ol><p>這裡想補充幾點： * 上述的需求中，如果有較描述模糊的地帶，這裏傾向先自己推理與腦補，實務上最好還是跟 PM 或客戶確認需求，避免雙方預期需求上的認知差異。 * 程式碼所使用的商品名稱來源是：<code>fixtures/texttest_fixture.php</code> 以及 <code>src/GildedRose</code>，例如： * 商品名稱：<code>Backstage</code>，在程式碼實際上名稱為 <code>Backstage passes to a TAFKAL80ETC concert</code> * 撰寫測試案例的流程，盡可能地將有關聯性的測試案例安排在一起先行撰寫，使後續撰寫測試程式碼時，也可避免出現不必要的修改。</p><h2 id="按照預期完成的測試案例項目撰寫程式碼">按照預期完成的測試案例項目撰寫程式碼</h2><h3 id="測試案例一">測試案例一</h3><ul><li>需求：確保一般的商品在每天結束後 ( 也就是 <code>updateQuality</code> 的 method 呼叫之後 )，系統會降低 <code>sellIn</code> 和 <code>quality</code> 兩種屬性，降低的程度由原程式碼所決定。</li></ul><p>既然我們已經擁有明確的測試案例以及需求了，接下來便是按照需求逐步完成測試，開啟預設的測試檔 <code>GildedRoseTest</code>，會看到下面這個 method：</p><div class="sourceCode" id="cb1"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">public</span> <span class="kw">function</span> testFoo<span class="ot">()</span></span><span id="cb1-2"><a href="#cb1-2"></a>{</span><span id="cb1-3"><a href="#cb1-3"></a>    <span class="kw">$items</span> = <span class="ot">[</span><span class="kw">new</span> Item<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)];</span></span><span id="cb1-4"><a href="#cb1-4"></a>    <span class="kw">$gildedRose</span> = <span class="kw">new</span> GildedRose<span class="ot">(</span><span class="kw">$items</span><span class="ot">);</span></span><span id="cb1-5"><a href="#cb1-5"></a>    <span class="kw">$gildedRose</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb1-6"><a href="#cb1-6"></a>    <span class="kw">$this</span>-&gt;assertEquals<span class="ot">(</span><span class="st">&quot;fixme&quot;</span><span class="ot">,</span> <span class="kw">$items</span><span class="ot">[</span><span class="dv">0</span><span class="ot">]</span>-&gt;name<span class="ot">);</span></span><span id="cb1-7"><a href="#cb1-7"></a>}</span></code></pre></div><p>接下來先進行基本的撰寫測試與重構，這裡開始描述實際撰寫測試的流程：</p><h5 id="實際撰寫測試的流程">實際撰寫測試的流程</h5><ul><li>修改 <code>testFoo</code> method 名稱為 <code>testNormalProductUpdateQuality</code> 方便理解這個測試案例的情境。</li><li>執行測試，發現紅燈： <code>Failed asserting that two strings are identical</code></li><li>修改 <code>item</code> 的 <code>quality</code> 以及 <code>sellIn</code> 為 1 ，滿足測試。</li><li>修正第一個 <code>assertEquals</code> 中第一個參數的 <code>fixme</code> 為 <code>foo</code>，並且調整 <code>assertEquals</code> 為 <code>assertSame</code> ，確保較嚴謹的判斷。</li><li>新增一個 <code>assertEquals</code> 來測試 <code>quality</code> 是否如預期下降 1， 為什麼是 1 呢？這個數字是從查看物件 <code>GildedRose</code> 裡面得知的，需求裡面沒有提到這一塊所以就沿用原設計。</li><li>新增一個 <code>assertEquals</code> 來測試 <code>sellIn</code> 是否如預期下降 1，原因如上</li><li>執行測試，綠燈。</li></ul><p>最後完成如下：</p><div class="sourceCode" id="cb2"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">public</span> <span class="kw">function</span> testNormalProductUpdateQuality<span class="ot">()</span></span><span id="cb2-2"><a href="#cb2-2"></a>{</span><span id="cb2-3"><a href="#cb2-3"></a>    <span class="kw">$item</span> = <span class="kw">new</span> Item<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">);</span></span><span id="cb2-4"><a href="#cb2-4"></a>    <span class="kw">$items</span> = <span class="ot">[</span><span class="kw">$item</span><span class="ot">];</span></span><span id="cb2-5"><a href="#cb2-5"></a>    <span class="kw">$gildedRose</span> = <span class="kw">new</span> GildedRose<span class="ot">(</span><span class="kw">$items</span><span class="ot">);</span></span><span id="cb2-6"><a href="#cb2-6"></a>    <span class="kw">$gildedRose</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb2-7"><a href="#cb2-7"></a>    <span class="kw">$this</span>-&gt;assertSame<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="kw">$item</span>-&gt;name<span class="ot">);</span></span><span id="cb2-8"><a href="#cb2-8"></a>    <span class="kw">$this</span>-&gt;assertSame<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="kw">$item</span>-&gt;sellIn<span class="ot">);</span></span><span id="cb2-9"><a href="#cb2-9"></a>    <span class="kw">$this</span>-&gt;assertSame<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="kw">$item</span>-&gt;quality<span class="ot">);</span></span><span id="cb2-10"><a href="#cb2-10"></a>}</span></code></pre></div><p>再來便是重構測試程式碼的流程，首先重構 <code>GildedRoseTest</code>：</p><ul><li>extract <code>new Item("foo", 0, 0)</code> 到 property，確保 IDE 可以取得存取的變數來源是什麼型別。</li><li>重構使用到 <code>item</code> 物件的程式碼。</li><li>extract 測試目標的 <code>item</code> 到 <code>GildedRoseTest</code> 上，以便滿足後續測試時需要將參數一一帶入至測試的 method</li><li>extract 測試方法 <code>shouldBe</code> ，減少之後重複的程式碼</li><li>補足 PHPDoc 或是強型別 ，確保 IDE(PHPStorm) 知道每一個物件的型別為何。</li></ul><p>最後完成如下：</p><div class="sourceCode" id="cb3"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb3-1"><a href="#cb3-1"></a></span><span id="cb3-2"><a href="#cb3-2"></a><span class="kw">class</span> GildedRoseTest <span class="kw">extends</span> TestCase</span><span id="cb3-3"><a href="#cb3-3"></a>{</span><span id="cb3-4"><a href="#cb3-4"></a>    <span class="co">/** </span><span class="an">@var</span><span class="co"> </span><span class="do">Item</span><span class="co"> */</span></span><span id="cb3-5"><a href="#cb3-5"></a>    <span class="kw">private</span> <span class="kw">$item</span><span class="ot">;</span></span><span id="cb3-6"><a href="#cb3-6"></a></span><span id="cb3-7"><a href="#cb3-7"></a>    <span class="kw">public</span> <span class="kw">function</span> testNormalProductUpdateQuality<span class="ot">()</span></span><span id="cb3-8"><a href="#cb3-8"></a>    {</span><span id="cb3-9"><a href="#cb3-9"></a>        <span class="kw">$this</span>-&gt;item = <span class="kw">new</span> Item<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">);</span></span><span id="cb3-10"><a href="#cb3-10"></a>        <span class="kw">$items</span> = <span class="ot">[</span><span class="kw">$this</span>-&gt;item<span class="ot">];</span></span><span id="cb3-11"><a href="#cb3-11"></a>        <span class="kw">$gildedRose</span> = <span class="kw">new</span> GildedRose<span class="ot">(</span><span class="kw">$items</span><span class="ot">);</span></span><span id="cb3-12"><a href="#cb3-12"></a>        <span class="kw">$gildedRose</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb3-13"><a href="#cb3-13"></a>        <span class="kw">$this</span>-&gt;assertSame<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="kw">$this</span>-&gt;item-&gt;name<span class="ot">);</span></span><span id="cb3-14"><a href="#cb3-14"></a>        <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb3-15"><a href="#cb3-15"></a>    }</span><span id="cb3-16"><a href="#cb3-16"></a></span><span id="cb3-17"><a href="#cb3-17"></a>    <span class="kw">protected</span> <span class="kw">function</span> shouldBe<span class="ot">(</span><span class="kw">int</span> <span class="kw">$sellIn</span><span class="ot">,</span> <span class="kw">int</span> <span class="kw">$quality</span><span class="ot">)</span>: <span class="kw">void</span></span><span id="cb3-18"><a href="#cb3-18"></a>    {</span><span id="cb3-19"><a href="#cb3-19"></a>        <span class="kw">$this</span>-&gt;assertSame<span class="ot">(</span><span class="kw">$sellIn</span><span class="ot">,</span> <span class="kw">$this</span>-&gt;item-&gt;sellIn<span class="ot">);</span></span><span id="cb3-20"><a href="#cb3-20"></a>        <span class="kw">$this</span>-&gt;assertSame<span class="ot">(</span><span class="kw">$quality</span><span class="ot">,</span> <span class="kw">$this</span>-&gt;item-&gt;quality<span class="ot">);</span></span><span id="cb3-21"><a href="#cb3-21"></a>    }</span><span id="cb3-22"><a href="#cb3-22"></a>}</span></code></pre></div><p>在重構完之後，再次執行測試，確認綠燈後便完成第一個測試案例，準備提交。</p><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/c3b0b14aec30b414bea0cfc961e23b6198a961ae" target="_blank" rel="noopener">git 測試案例一提交記錄</a></p><h3 id="測試案例二">測試案例二</h3><ul><li>需求：確保 <code>item</code> 的 <code>quality</code> 從不為負數</li></ul><h5 id="實際撰寫測試的流程-1">實際撰寫測試的流程</h5><ul><li>新增測試 method <code>testProductQualityOrSellInIsNeverBeLessThenZero</code></li><li>複製 測試案例一 的程式碼，並將 <code>sellIn</code> 以及 <code>quality</code> 改為 0，預期這兩個屬性在 <code>updateQuality</code> 之後，仍然為 0</li><li>執行測試，發現紅燈： <code>Failed asserting that -1 is identical to 0</code>，這是 <code>quality</code> 的錯誤。</li><li>修正 <code>GildedRose</code> 物件的程式碼滿足測試，修改的程式碼如下：</li></ul><p><img src="test_case_2.png" /></p><ul><li>執行測試，綠燈，完成如下：</li></ul><div class="sourceCode" id="cb4"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb4-1"><a href="#cb4-1"></a></span><span id="cb4-2"><a href="#cb4-2"></a><span class="kw">public</span> <span class="kw">function</span> testProductQualityOrSellInIsNeverBeLessThenZero<span class="ot">()</span></span><span id="cb4-3"><a href="#cb4-3"></a>{</span><span id="cb4-4"><a href="#cb4-4"></a>    <span class="kw">$this</span>-&gt;item = <span class="kw">new</span> Item<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb4-5"><a href="#cb4-5"></a>    <span class="kw">$items</span> = <span class="ot">[</span><span class="kw">$this</span>-&gt;item<span class="ot">];</span></span><span id="cb4-6"><a href="#cb4-6"></a>    <span class="kw">$gildedRose</span> = <span class="kw">new</span> GildedRose<span class="ot">(</span><span class="kw">$items</span><span class="ot">);</span></span><span id="cb4-7"><a href="#cb4-7"></a>    <span class="kw">$gildedRose</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb4-8"><a href="#cb4-8"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb4-9"><a href="#cb4-9"></a>}</span></code></pre></div><p>開始重構測試程式碼</p><ul><li>在 <code>GildedRose</code> 的屬性 <code>items</code> 新增 PHPDoc ，使 PHPStorm 可以讀取來源：</li></ul><div class="sourceCode" id="cb5"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">/** </span><span class="an">@var</span><span class="co"> </span><span class="do">Item[]</span><span class="co"> */</span></span><span id="cb5-2"><a href="#cb5-2"></a><span class="kw">private</span> <span class="kw">$items</span> = <span class="ot">[];</span></span></code></pre></div><ul><li>extract 建立 <code>GildedRose</code> 的那一段程式碼 extract 到一個新的 method 為 <code>updateQuality</code>，常用的程式碼以便之後重複使用：</li></ul><div class="sourceCode" id="cb6"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb6-1"><a href="#cb6-1"></a></span><span id="cb6-2"><a href="#cb6-2"></a><span class="kw">protected</span> <span class="kw">function</span> updateQuality<span class="ot">()</span>: <span class="kw">void</span></span><span id="cb6-3"><a href="#cb6-3"></a>{</span><span id="cb6-4"><a href="#cb6-4"></a>    <span class="kw">$items</span> = <span class="ot">[</span><span class="kw">$this</span>-&gt;item<span class="ot">];</span></span><span id="cb6-5"><a href="#cb6-5"></a>    <span class="kw">$gildedRose</span> = <span class="kw">new</span> GildedRose<span class="ot">(</span><span class="kw">$items</span><span class="ot">);</span></span><span id="cb6-6"><a href="#cb6-6"></a>    <span class="kw">$gildedRose</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb6-7"><a href="#cb6-7"></a>}</span></code></pre></div><ul><li>extract 建立 <code>Item</code> 的邏輯下面這一個 method，一樣是為了使常用的程式碼能重複使用 ：</li></ul><div class="sourceCode" id="cb7"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb7-1"><a href="#cb7-1"></a></span><span id="cb7-2"><a href="#cb7-2"></a><span class="kw">protected</span> <span class="kw">function</span> createItem<span class="ot">(</span><span class="kw">string</span> <span class="kw">$name</span><span class="ot">,</span> <span class="kw">int</span> <span class="kw">$sellIn</span><span class="ot">,</span> <span class="kw">int</span> <span class="kw">$quality</span><span class="ot">)</span></span><span id="cb7-3"><a href="#cb7-3"></a>{</span><span id="cb7-4"><a href="#cb7-4"></a>    <span class="kw">$this</span>-&gt;item = <span class="kw">new</span> Item<span class="ot">(</span><span class="kw">$name</span><span class="ot">,</span> <span class="kw">$sellIn</span><span class="ot">,</span> <span class="kw">$quality</span><span class="ot">);</span></span><span id="cb7-5"><a href="#cb7-5"></a>}</span></code></pre></div><ul><li>執行測試，綠燈，完成的程式碼如下：</li></ul><div class="sourceCode" id="cb8"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb8-1"><a href="#cb8-1"></a></span><span id="cb8-2"><a href="#cb8-2"></a><span class="kw">public</span> <span class="kw">function</span> testNormalProductUpdateQuality<span class="ot">()</span></span><span id="cb8-3"><a href="#cb8-3"></a>{</span><span id="cb8-4"><a href="#cb8-4"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">);</span></span><span id="cb8-5"><a href="#cb8-5"></a>    <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb8-6"><a href="#cb8-6"></a>    <span class="kw">$this</span>-&gt;assertSame<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="kw">$this</span>-&gt;item-&gt;name<span class="ot">);</span></span><span id="cb8-7"><a href="#cb8-7"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb8-8"><a href="#cb8-8"></a>}</span><span id="cb8-9"><a href="#cb8-9"></a></span><span id="cb8-10"><a href="#cb8-10"></a><span class="kw">public</span> <span class="kw">function</span> testProductQualityOrSellInIsNeverBeLessThenZero<span class="ot">()</span></span><span id="cb8-11"><a href="#cb8-11"></a>{</span><span id="cb8-12"><a href="#cb8-12"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb8-13"><a href="#cb8-13"></a>    <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb8-14"><a href="#cb8-14"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb8-15"><a href="#cb8-15"></a>}</span></code></pre></div><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/5df69be2967dbf713c3243f995ab65e57e202530" target="_blank" rel="noopener">git 測試案例二提交記錄</a></p><h3 id="測試案例三">測試案例三</h3><ul><li>需求：確保 <code>item</code> 的<code>sellIn</code> 為零時，若 <code>quality</code> 還不等於零，其下降速度是原本的兩倍</li></ul><p>實際撰寫測試的流程</p><ul><li>新增測試 method <code>testProductQualityDecreaseDoubleWhenSellInIsZero</code></li><li>初始化商品的 <code>sellIn</code> 為 0 ，然後 <code>quality</code> 為 2</li><li>撰寫測試，預期在 <code>updateQuality</code> 之後， <code>quality</code> 為 0</li><li>執行測試，發現紅燈： <code>Failed asserting that 1 is identical to 0.</code>，看來原本的設計是沒有撰寫這一部分邏輯</li><li>補足需求：<code>sellIn</code> 為零時，若 <code>quality</code> 還不等於零，其下降速度是原本的兩倍，修改 <code>GildedRose</code> 程式碼如下：</li></ul><p><img src="test_case_3.png" /></p><ul><li>執行測試，綠燈</li></ul><div class="sourceCode" id="cb9"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb9-1"><a href="#cb9-1"></a></span><span id="cb9-2"><a href="#cb9-2"></a><span class="kw">public</span> <span class="kw">function</span> testProductQualityDecreaseDoubleWhenSellInIsZero<span class="ot">()</span></span><span id="cb9-3"><a href="#cb9-3"></a>{</span><span id="cb9-4"><a href="#cb9-4"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">);</span></span><span id="cb9-5"><a href="#cb9-5"></a>    <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb9-6"><a href="#cb9-6"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb9-7"><a href="#cb9-7"></a>}</span></code></pre></div><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/2ce47df88a4507855a287856deac3f16086ff979" target="_blank" rel="noopener">git 測試案例三提交記錄</a></p><h3 id="測試案例四">測試案例四</h3><ul><li>需求：商品 Aged Brie 的物件 <code>item</code>，經過 <code>updateQuality</code> 呼叫之後，其 <code>quality</code> 不減反增，即使在 <code>sellIn</code> 歸零也是</li></ul><p>實際撰寫測試的流程</p><ul><li>新增測試 method <code>testAgedBrieUpdateQualityIsAlwaysIncrease</code></li><li>初始化商品的 <code>sellIn</code> 為 0 ，然後 <code>quality</code> 為 2，這裡的名稱改為 <code>Aged Brie</code></li><li>撰寫測試，預期在 <code>updateQuality</code> 之後， <code>quality</code> 為 3</li><li>執行測試，綠燈</li></ul><div class="sourceCode" id="cb10"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb10-1"><a href="#cb10-1"></a></span><span id="cb10-2"><a href="#cb10-2"></a><span class="kw">public</span> <span class="kw">function</span> testAgedBrieUpdateQualityIsAlwaysIncrease<span class="ot">()</span></span><span id="cb10-3"><a href="#cb10-3"></a>{</span><span id="cb10-4"><a href="#cb10-4"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Aged Brie&quot;</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">);</span></span><span id="cb10-5"><a href="#cb10-5"></a>    <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb10-6"><a href="#cb10-6"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">);</span></span><span id="cb10-7"><a href="#cb10-7"></a>}</span></code></pre></div><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/9a9c984395adf1dd03c248133a9cdbbeab90f6c7" target="_blank" rel="noopener">git 測試案例四提交記錄</a></p><h3 id="測試案例五">測試案例五</h3><ul><li>需求： 確保 <code>item</code> 的 <code>quality</code> 從來不超過 50</li></ul><p>這一個案例想補充一下，按理來說應該可以測試兩個地方：</p><ul><li>初始化 <code>item</code> 的時候<code>quality</code> 就不允許 50 以上的參數</li><li>新增<code>quality</code> 的時候，到達 50 就不給予新增</li></ul><p>由於初始化不允許 50 以上的參數處理有兩種，要嘛自動降為 50 ，要嘛拋出 Exception ，但這裏題目也沒特別提到，我選擇自己腦補拋出 Exception。</p><p>實際撰寫測試的流程：</p><ul><li>新增一個 <code>InvalidItemQualityException</code> Exception 物件在 <code>src</code> 目錄</li><li>修改 <code>Item</code> 物件的 <code>__construct</code> method 如下</li></ul><div class="sourceCode" id="cb11"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">function</span> <span class="fu">__construct</span><span class="ot">(</span><span class="kw">$name</span><span class="ot">,</span> <span class="kw">$sellIn</span><span class="ot">,</span> <span class="kw">$quality</span><span class="ot">)</span></span><span id="cb11-2"><a href="#cb11-2"></a>{</span><span id="cb11-3"><a href="#cb11-3"></a>    <span class="kw">if</span><span class="ot">(</span><span class="kw">$quality</span> &gt; <span class="dv">50</span><span class="ot">)</span>{</span><span id="cb11-4"><a href="#cb11-4"></a>        <span class="kw">throw</span> <span class="kw">new</span> InvalidItemQualityException<span class="ot">();</span></span><span id="cb11-5"><a href="#cb11-5"></a>    }</span><span id="cb11-6"><a href="#cb11-6"></a>    <span class="kw">$this</span>-&gt;name = <span class="kw">$name</span><span class="ot">;</span></span><span id="cb11-7"><a href="#cb11-7"></a>    <span class="kw">$this</span>-&gt;sellIn = <span class="kw">$sellIn</span><span class="ot">;</span></span><span id="cb11-8"><a href="#cb11-8"></a>    <span class="kw">$this</span>-&gt;quality = <span class="kw">$quality</span><span class="ot">;</span></span><span id="cb11-9"><a href="#cb11-9"></a>}</span></code></pre></div><ul><li>新增測試 method <code>testProductQualityNeverGreaterThen_51</code></li><li>建立一個 <code>quality</code> 為 51 的 <code>Item</code>，並且預期拋出一個 <code>InvalidItemQualityException</code> 的 Exception</li><li>執行測試，綠燈</li><li>建立一個 <code>Aged Brie</code> 的物件， <code>quality</code> 為 50</li><li>撰寫測試，預期在 <code>updateQuality</code> 之後， <code>quality</code> 仍然為 50</li><li>執行測試，綠燈</li></ul><div class="sourceCode" id="cb12"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb12-1"><a href="#cb12-1"></a></span><span id="cb12-2"><a href="#cb12-2"></a><span class="kw">public</span> <span class="kw">function</span> testProductQualityNeverGreaterThen_51<span class="ot">()</span></span><span id="cb12-3"><a href="#cb12-3"></a>{</span><span id="cb12-4"><a href="#cb12-4"></a>    <span class="kw">$this</span>-&gt;expectException<span class="ot">(</span>InvalidItemQualityException::<span class="kw">class</span><span class="ot">);</span></span><span id="cb12-5"><a href="#cb12-5"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;foo&quot;</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">51</span><span class="ot">);</span></span><span id="cb12-6"><a href="#cb12-6"></a></span><span id="cb12-7"><a href="#cb12-7"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Aged Brie&quot;</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">);</span></span><span id="cb12-8"><a href="#cb12-8"></a>    <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb12-9"><a href="#cb12-9"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">);</span></span><span id="cb12-10"><a href="#cb12-10"></a>}</span></code></pre></div><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/76b9003a8befd6d9de922111d43a1bd0c9bb9537" target="_blank" rel="noopener">git 測試案例五提交記錄</a></p><h3 id="測試案例六">測試案例六</h3><ul><li>需求：魔法槌商品的物件 <code>item</code> ，其 <code>sellIn</code> 和 <code>quality</code> 初始化後，永久不變</li></ul><p>實際撰寫測試的流程：</p><ul><li>新增測試 method <code>testSulfurasSellInQuality</code></li><li>建立一個名稱為 <code>Sulfuras, Hand of Ragnaros</code> 的 <code>Item</code>， <code>sellIn</code> 和 <code>quality</code> 為 3</li><li>撰寫測試，預期在 <code>updateQuality</code> 之後， <code>sellIn</code> 和 <code>quality</code> 仍然為 3</li><li>執行測試，綠燈</li></ul><div class="sourceCode" id="cb13"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb13-1"><a href="#cb13-1"></a></span><span id="cb13-2"><a href="#cb13-2"></a><span class="kw">public</span> <span class="kw">function</span> testSulfurasSellInQuality<span class="ot">()</span></span><span id="cb13-3"><a href="#cb13-3"></a>{</span><span id="cb13-4"><a href="#cb13-4"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Sulfuras, Hand of Ragnaros&quot;</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">);</span></span><span id="cb13-5"><a href="#cb13-5"></a>    <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb13-6"><a href="#cb13-6"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">3</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">);</span></span><span id="cb13-7"><a href="#cb13-7"></a>}</span></code></pre></div><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/7d1b82d0632bf68471ef5f39c5bb5b20d94937b9" target="_blank" rel="noopener">git 測試案例六提交記錄</a></p><h3 id="測試案例七">測試案例七</h3><ul><li>需求：商品 Backstage passes 的物件 <code>item</code> 須滿足下列條件：<ul><li>當 <code>sellIn</code> 為 <code>9</code> 到 <code>6</code> 的時候，<code>updateQuality</code> 一次提升 <code>quality</code> 2</li><li>當 <code>sellIn</code> 為 <code>5</code> 到 <code>1</code> 的時候，<code>updateQuality</code> 一次提升 <code>quality</code> 3</li><li>當 <code>sellIn</code> 為 <code>0</code>，<code>quality</code> 將直接歸零</li></ul></li></ul><p>這邊標題雖然打測試案例七，但實際上是增加 3 個測試案例，皆是針對 <code>Backstage</code> 商品的。</p><p>實際撰寫測試的流程： #### 測試案例七之一 ： 當 <code>sellIn</code> 為 <code>9</code> 到 <code>6</code> 的時候，<code>updateQuality</code> 一次提升 <code>quality</code> 2 - 新增測試 method <code>testBackstagePassesQualityWhenSellInIsLessThanTenDay</code> - 建立一個名稱為 <code>Sulfuras, Hand of Ragnaros</code> 的 <code>Item</code>， <code>sellIn</code> 為 9 和 <code>quality</code> 為 0 - 測試在 <code>sellIn</code> 為 9 ~ 6 的時候，每次 <code>updateQuality</code> 都會新增 2 - 執行測試，綠燈</p><div class="sourceCode" id="cb14"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb14-1"><a href="#cb14-1"></a></span><span id="cb14-2"><a href="#cb14-2"></a><span class="kw">public</span> <span class="kw">function</span> testBackstagePassesQualityWhenSellInIsLessThanTenDay<span class="ot">()</span></span><span id="cb14-3"><a href="#cb14-3"></a>{</span><span id="cb14-4"><a href="#cb14-4"></a>    <span class="kw">$expectedSellIn</span> = <span class="dv">10</span><span class="ot">;</span></span><span id="cb14-5"><a href="#cb14-5"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Backstage passes to a TAFKAL80ETC concert&quot;</span><span class="ot">,</span> <span class="kw">$expectedSellIn</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb14-6"><a href="#cb14-6"></a>    <span class="kw">$exceptedQuality</span> = <span class="dv">2</span><span class="ot">;</span></span><span id="cb14-7"><a href="#cb14-7"></a></span><span id="cb14-8"><a href="#cb14-8"></a>    <span class="kw">$exceptedSellIns</span> = <span class="fu">range</span><span class="ot">(</span><span class="kw">$expectedSellIn</span><span class="ot">,</span> <span class="dv">6</span><span class="ot">);</span></span><span id="cb14-9"><a href="#cb14-9"></a>    <span class="kw">foreach</span> <span class="ot">(</span><span class="kw">$exceptedSellIns</span> <span class="kw">as</span> <span class="kw">$expectedSellIn</span><span class="ot">)</span> {</span><span id="cb14-10"><a href="#cb14-10"></a>        <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb14-11"><a href="#cb14-11"></a>        <span class="kw">$expectedSellIn</span>--<span class="ot">;</span></span><span id="cb14-12"><a href="#cb14-12"></a>        <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="kw">$expectedSellIn</span><span class="ot">,</span> <span class="kw">$exceptedQuality</span><span class="ot">);</span></span><span id="cb14-13"><a href="#cb14-13"></a>        <span class="kw">$exceptedQuality</span> += <span class="dv">2</span><span class="ot">;</span></span><span id="cb14-14"><a href="#cb14-14"></a>    }</span><span id="cb14-15"><a href="#cb14-15"></a>}</span></code></pre></div><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/e777742aaf09f33fde73464791f9f0cbcbbfdef0" target="_blank" rel="noopener">git 測試案例七之一提交記錄</a></p><h4 id="測試案例七之二-當-sellin-為-5-到-1-的時候updatequality-一次提升-quality-3">測試案例七之二 ： 當 <code>sellIn</code> 為 <code>5</code> 到 <code>1</code> 的時候，<code>updateQuality</code> 一次提升 <code>quality</code> 3</h4><ul><li>新增測試 method <code>testBackstagePassesQualityWhenSellInIsLessThanFiveDay</code>，可以直接複製上一個 測試 。</li><li>測試在 <code>sellIn</code> 為 5 ~ 1 的時候，每次 <code>updateQuality</code> 都會新增 3</li><li>執行測試，綠燈</li></ul><div class="sourceCode" id="cb15"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb15-1"><a href="#cb15-1"></a></span><span id="cb15-2"><a href="#cb15-2"></a><span class="kw">public</span> <span class="kw">function</span> testBackstagePassesQualityWhenSellInIsLessThanFiveDay<span class="ot">()</span></span><span id="cb15-3"><a href="#cb15-3"></a>{</span><span id="cb15-4"><a href="#cb15-4"></a>    <span class="kw">$expectedSellIn</span> = <span class="dv">5</span><span class="ot">;</span></span><span id="cb15-5"><a href="#cb15-5"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Backstage passes to a TAFKAL80ETC concert&quot;</span><span class="ot">,</span> <span class="kw">$expectedSellIn</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb15-6"><a href="#cb15-6"></a>    <span class="kw">$exceptedQuality</span> = <span class="dv">3</span><span class="ot">;</span></span><span id="cb15-7"><a href="#cb15-7"></a></span><span id="cb15-8"><a href="#cb15-8"></a>    <span class="kw">$exceptedSellIns</span> = <span class="fu">range</span><span class="ot">(</span><span class="kw">$expectedSellIn</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">);</span></span><span id="cb15-9"><a href="#cb15-9"></a>    <span class="kw">foreach</span> <span class="ot">(</span><span class="kw">$exceptedSellIns</span> <span class="kw">as</span> <span class="kw">$expectedSellIn</span><span class="ot">)</span> {</span><span id="cb15-10"><a href="#cb15-10"></a>        <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb15-11"><a href="#cb15-11"></a>        <span class="kw">$expectedSellIn</span>--<span class="ot">;</span></span><span id="cb15-12"><a href="#cb15-12"></a>        <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="kw">$expectedSellIn</span><span class="ot">,</span> <span class="kw">$exceptedQuality</span><span class="ot">);</span></span><span id="cb15-13"><a href="#cb15-13"></a>        <span class="kw">$exceptedQuality</span> += <span class="dv">3</span><span class="ot">;</span></span><span id="cb15-14"><a href="#cb15-14"></a>    }</span><span id="cb15-15"><a href="#cb15-15"></a>}</span></code></pre></div><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/5d8fccec9f06dc51d6e5f87f704ab8cabd53aea2" target="_blank" rel="noopener">git 測試案例七之二提交記錄</a></p><h4 id="測試案例七之三-當-sellin-為-0-quality-將直接歸零">測試案例七之三 ： 當 <code>sellIn</code> 為 0， <code>quality</code> 將直接歸零</h4><ul><li>新增測試 method <code>testBackstagePassesQualityIsZeroWhenSellInIsZero</code>，可以直接複製上一個 測試 。</li><li>測試初始化 <code>sellIn</code> 為 1 而 <code>quality</code> 為 30 的時候， <code>updateQuality</code> 之後，預期 <code>quality</code> 為 0</li></ul><div class="sourceCode" id="cb16"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb16-1"><a href="#cb16-1"></a></span><span id="cb16-2"><a href="#cb16-2"></a><span class="kw">public</span> <span class="kw">function</span> testBackstagePassesQualityIsZeroWhenSellInIsZero<span class="ot">()</span></span><span id="cb16-3"><a href="#cb16-3"></a>{</span><span id="cb16-4"><a href="#cb16-4"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Backstage passes to a TAFKAL80ETC concert&quot;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">30</span><span class="ot">);</span></span><span id="cb16-5"><a href="#cb16-5"></a>    <span class="kw">$this</span>-&gt;updateQuality<span class="ot">();</span></span><span id="cb16-6"><a href="#cb16-6"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">);</span></span><span id="cb16-7"><a href="#cb16-7"></a>}</span></code></pre></div><ul><li>執行測試，紅燈： <code>Failed asserting that 33 is identical to 0.</code></li><li>修改 <code>GildedRose</code> 物件，滿足測試案例</li></ul><p><img src="test_case_7.png" /></p><ul><li>執行測試，綠燈</li></ul><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/903edbc48f3f3f755b8387896d3a3d43d045a830" target="_blank" rel="noopener">git 測試案例七之三提交記錄</a></p><h2 id="重構-legacy-code">重構 legacy code</h2><h3 id="重構波動拳程式碼的策略">重構波動拳程式碼的策略</h3><p>我們已經完成了除了測試案例 9 的所有測試案例了，在測試的保護下我們即將對 legacy code 進行重構，也就是清除波動拳的程式碼 <code>updateQuality</code> 。</p><p>重構的目的是希望在保留既有的程式碼 <strong>功能</strong> 之下，優化程式碼的架構，我在處理波動拳的程式時(這題先不考慮以物件為單位分離職責的)，有自己常用的套路：</p><ul><li>可以合併的 if / else 或是可 extract 成一個 method 程式便 extract，並給予一個更容易了解的命名方式</li><li>充分確認流程的前因後果後，以 method 的方式分離職責，並調整執行的順序。</li><li>扁平化 if / else 結構，在 clean code 裡面，盡量避免 if / else 裡面有過多的 if / else ，可使用 <code>return</code> &amp; <code>switch</code> 來幫助我們完成這個任務</li><li>調整後不忘進行測試，確保調整是安全無慮的</li><li>專注測試一個測試案例，保持測試案例獨立性的同時，也保留舊有的 legacy code<ul><li>例如，將新增的 switch 放在舊有 legacy code 最前方，並專注一個 <code>case</code> 撰寫，執行完之後便 <code>return</code> ，逐步完成所有程式碼，最後即可移除 legacy code。</li></ul></li></ul><p>其實本來想嘗試描述重構過程，但發現要描述整個流程過於繁瑣冗長，這裡就跳過了描述了，請直接看重構後的程式碼。</p><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/dd9287b1f8666f8916825c821b8ef3783b40b723" target="_blank" rel="noopener">git 重構後的提交記錄</a></p><h2 id="tdd-新增新的需求">TDD 新增新的需求</h2><p>需求：新增一個 Conjured 商品，<code>updateQuality</code> 所下降的值為正常商品的兩倍</p><p>實際撰寫測試的流程：</p><ul><li>TDD 的開發流程為 <strong>紅燈</strong> → <strong>綠燈</strong> → <strong>重構</strong>，所以我們先按照需求寫測試，取得第一個紅燈</li><li>新增一個測試 method <code>testConjuredUpdateQuality</code></li></ul><div class="sourceCode" id="cb17"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb17-1"><a href="#cb17-1"></a></span><span id="cb17-2"><a href="#cb17-2"></a><span class="kw">public</span> <span class="kw">function</span> testConjuredUpdateQuality<span class="ot">()</span></span><span id="cb17-3"><a href="#cb17-3"></a>{</span><span id="cb17-4"><a href="#cb17-4"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Conjured Mana Cake&quot;</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">20</span><span class="ot">);</span></span><span id="cb17-5"><a href="#cb17-5"></a>    <span class="kw">$this</span>-&gt;updateItems<span class="ot">();</span></span><span id="cb17-6"><a href="#cb17-6"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">18</span><span class="ot">);</span></span><span id="cb17-7"><a href="#cb17-7"></a>}</span></code></pre></div><ul><li>測試，紅燈： <code>Failed asserting that 2 is identical to 1.</code></li><li>再來修改 <code>GildedRose</code> 物件的 <code>updateItem</code> method 來滿足需求，首先修改 <code>updateItem</code> Method</li></ul><div class="sourceCode" id="cb18"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb18-1"><a href="#cb18-1"></a></span><span id="cb18-2"><a href="#cb18-2"></a><span class="kw">protected</span> <span class="kw">function</span> updateItem<span class="ot">(</span>Item <span class="kw">$item</span><span class="ot">)</span>: <span class="kw">void</span></span><span id="cb18-3"><a href="#cb18-3"></a>{</span><span id="cb18-4"><a href="#cb18-4"></a>    <span class="kw">switch</span> <span class="ot">(</span><span class="kw">$item</span>-&gt;name<span class="ot">)</span> {</span><span id="cb18-5"><a href="#cb18-5"></a>        <span class="co">// ...省略</span></span><span id="cb18-6"><a href="#cb18-6"></a>        <span class="kw">case </span><span class="st">&quot;Conjured Mana Cake&quot;</span><span class="ot">:</span></span><span id="cb18-7"><a href="#cb18-7"></a>            <span class="kw">$this</span>-&gt;updateConjured<span class="ot">(</span><span class="kw">$item</span><span class="ot">);</span></span><span id="cb18-8"><a href="#cb18-8"></a>            <span class="kw">break</span><span class="ot">;</span></span><span id="cb18-9"><a href="#cb18-9"></a>        <span class="kw">default:</span></span><span id="cb18-10"><a href="#cb18-10"></a>            <span class="kw">$this</span>-&gt;updateNoramlProduct<span class="ot">(</span><span class="kw">$item</span><span class="ot">);</span></span><span id="cb18-11"><a href="#cb18-11"></a>    }</span><span id="cb18-12"><a href="#cb18-12"></a>}</span></code></pre></div><ul><li>再來處理細節 <code>updateConjured</code> method</li></ul><div class="sourceCode" id="cb19"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">protected</span> <span class="kw">function</span> updateConjured<span class="ot">(</span>Item <span class="kw">$item</span><span class="ot">)</span>: <span class="kw">void</span></span><span id="cb19-2"><a href="#cb19-2"></a>{</span><span id="cb19-3"><a href="#cb19-3"></a>    <span class="kw">if</span> <span class="ot">(</span><span class="kw">$item</span>-&gt;sellIn &gt; <span class="dv">0</span><span class="ot">)</span> {</span><span id="cb19-4"><a href="#cb19-4"></a>        <span class="kw">$item</span>-&gt;sellIn--<span class="ot">;</span></span><span id="cb19-5"><a href="#cb19-5"></a>    }</span><span id="cb19-6"><a href="#cb19-6"></a></span><span id="cb19-7"><a href="#cb19-7"></a>    <span class="kw">$decreaseNum</span> = <span class="dv">2</span><span class="ot">;</span></span><span id="cb19-8"><a href="#cb19-8"></a>    <span class="kw">if</span> <span class="ot">((</span><span class="kw">$item</span>-&gt;quality - <span class="kw">$decreaseNum</span><span class="ot">)</span> &lt; <span class="dv">0</span><span class="ot">)</span> {</span><span id="cb19-9"><a href="#cb19-9"></a>        <span class="kw">$item</span>-&gt;quality = <span class="dv">0</span><span class="ot">;</span></span><span id="cb19-10"><a href="#cb19-10"></a>        <span class="kw">return</span><span class="ot">;</span></span><span id="cb19-11"><a href="#cb19-11"></a>    }</span><span id="cb19-12"><a href="#cb19-12"></a>    <span class="kw">$item</span>-&gt;quality = <span class="kw">$item</span>-&gt;quality - <span class="kw">$decreaseNum</span><span class="ot">;</span></span><span id="cb19-13"><a href="#cb19-13"></a>}</span></code></pre></div><ul><li>執行測試，綠燈</li><li>目前為止，所有的測試案例便算是完成了，在 TDD 的流程，本該是綠燈後進行重構，但程式碼看下來沒有發現需要重構的部分，所以便在此結束</li></ul><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commit/ca2c117051e3bf497b18d50d39987eacd473dc2e" target="_blank" rel="noopener">git TDD新增的提交記錄</a></p><h2 id="修正測試案例五漏洞">修正測試案例五漏洞</h2><ul><li>需求： 確保商品劇院後台通行證(Backstage passes) <code>item</code> 的 <code>quality</code> 從來不超過 50</li></ul><p>剛剛在整理整個筆記的時候，意外發現 測試案例五 有一個漏網之魚便是商品劇院後台通行證(Backstage passes)，所以這裡再新增一個測試案例來補足這一部分。</p><p>實際撰寫測試的流程：</p><ul><li>新增測試 method <code>testBackstagePassesQualityNeverGreaterThen_51</code></li><li>依照 劇院後台通行證 不同的 3 種情況，新增 quality 數值，來撰寫測試，預期皆不超過 50</li></ul><div class="sourceCode" id="cb20"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">public</span> <span class="kw">function</span> testBackstagePassesQualityNeverGreaterThen_51<span class="ot">()</span></span><span id="cb20-2"><a href="#cb20-2"></a>{</span><span id="cb20-3"><a href="#cb20-3"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Backstage passes to a TAFKAL80ETC concert&quot;</span><span class="ot">,</span> <span class="dv">15</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">);</span></span><span id="cb20-4"><a href="#cb20-4"></a>    <span class="kw">$this</span>-&gt;updateItems<span class="ot">();</span></span><span id="cb20-5"><a href="#cb20-5"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">14</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">);</span></span><span id="cb20-6"><a href="#cb20-6"></a></span><span id="cb20-7"><a href="#cb20-7"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Backstage passes to a TAFKAL80ETC concert&quot;</span><span class="ot">,</span> <span class="dv">9</span><span class="ot">,</span> <span class="dv">49</span><span class="ot">);</span></span><span id="cb20-8"><a href="#cb20-8"></a>    <span class="kw">$this</span>-&gt;updateItems<span class="ot">();</span></span><span id="cb20-9"><a href="#cb20-9"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">8</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">);</span></span><span id="cb20-10"><a href="#cb20-10"></a></span><span id="cb20-11"><a href="#cb20-11"></a>    <span class="kw">$this</span>-&gt;createItem<span class="ot">(</span><span class="st">&quot;Backstage passes to a TAFKAL80ETC concert&quot;</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">,</span> <span class="dv">49</span><span class="ot">);</span></span><span id="cb20-12"><a href="#cb20-12"></a>    <span class="kw">$this</span>-&gt;updateItems<span class="ot">();</span></span><span id="cb20-13"><a href="#cb20-13"></a>    <span class="kw">$this</span>-&gt;shouldBe<span class="ot">(</span><span class="dv">3</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">);</span></span><span id="cb20-14"><a href="#cb20-14"></a>}</span></code></pre></div><ul><li>執行測試，紅燈：<code>Failed asserting that 51 is identical to 50.</code></li><li>基本上寫完第一個是紅燈，再來我們調整物件 <code>GildedRose</code></li><li>這邊調整的部分較多，首先先在 <code>updateItems</code> 的 method 新增一個新的 method</li></ul><div class="sourceCode" id="cb21"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">public</span> <span class="kw">function</span> updateItems<span class="ot">()</span></span><span id="cb21-2"><a href="#cb21-2"></a>{</span><span id="cb21-3"><a href="#cb21-3"></a>    <span class="kw">foreach</span> <span class="ot">(</span><span class="kw">$this</span>-&gt;items <span class="kw">as</span> <span class="kw">$item</span><span class="ot">)</span> {</span><span id="cb21-4"><a href="#cb21-4"></a>        <span class="kw">$this</span>-&gt;updateItem<span class="ot">(</span><span class="kw">$item</span><span class="ot">);</span></span><span id="cb21-5"><a href="#cb21-5"></a>        <span class="kw">$this</span>-&gt;setItmQualityWhenTooMuch<span class="ot">(</span><span class="kw">$item</span><span class="ot">);</span></span><span id="cb21-6"><a href="#cb21-6"></a>    }</span><span id="cb21-7"><a href="#cb21-7"></a>}</span><span id="cb21-8"><a href="#cb21-8"></a></span><span id="cb21-9"><a href="#cb21-9"></a><span class="co">// ... 省略</span></span><span id="cb21-10"><a href="#cb21-10"></a></span><span id="cb21-11"><a href="#cb21-11"></a><span class="kw">protected</span> <span class="kw">function</span> setItmQualityWhenTooMuch<span class="ot">(</span>Item <span class="kw">$item</span><span class="ot">)</span></span><span id="cb21-12"><a href="#cb21-12"></a>{</span><span id="cb21-13"><a href="#cb21-13"></a>    <span class="kw">if</span><span class="ot">(</span><span class="kw">$item</span>-&gt;quality &gt; <span class="dv">50</span><span class="ot">)</span>{</span><span id="cb21-14"><a href="#cb21-14"></a>        <span class="kw">$item</span>-&gt;quality = <span class="dv">50</span><span class="ot">;</span></span><span id="cb21-15"><a href="#cb21-15"></a>    }</span><span id="cb21-16"><a href="#cb21-16"></a>}</span></code></pre></div><ul><li>這樣的設計是傾向，無論 <code>quality</code> 怎麼加，只要超過 50 便重設至 50，這樣寫的好處是可以一次適用所有的產品，而且考量到原本的設計還會先用 <code>if</code> 檢查，兩種寫法相較之下，無疑前者的寫法更為簡潔有力。</li><li>所以這裏我們不忘移除掉在 <code>updateAgedBrieQuality</code> 裡面不必要的檢查</li></ul><p><img src="update_check.png" /></p><ul><li>執行測試，綠燈</li></ul><p><a href="https://github.com/mpp21x/PHP-GildedRoseRefactoringKata/commits/master" target="_blank" rel="noopener">git 修正測試案例五漏洞 的提交</a></p><h5 id="其他參考連結">其他參考連結</h5><p>這裏順便附上讀書會其他人分享的解題思路。</p><ul><li><p><a href="https://github.com/holyblue/GildedRoseKata" target="_blank" rel="noopener">講者 Blues 的解題思路</a></p></li><li><p><a href="https://gist.github.com/FongX777/fb36c10fb698e69adbf027044cfc88ec" target="_blank" rel="noopener">主辦社群成員 Fong 的解題</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> refactoring </tag>
            
            <tag> kata </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP Reflection</title>
      <link href="/2020/03/24/2020/php-reflection/"/>
      <url>/2020/03/24/2020/php-reflection/</url>
      
        <content type="html"><![CDATA[<h5 id="摘要">摘要</h5><ul><li>Annotation 假註解，真程式碼</li><li>何謂 Annotation &amp; Reflection</li><li>實作 PHP Annotation</li></ul><h2 id="annotation-假註解真程式碼">Annotation 假註解，真程式碼</h2><p>從 Doctrine 開始說起， Symfony 是我所接觸的第一個 PHP Framework，使用 Symfony 所整合的 PHP ORM Library Doctrine ，在 Doctrine 當中，曾經有一段程式碼是我當時作為一個新手工程師無法理解的，就是所謂的 Annotation，也就是下方註解當中的 <code>@ORM\Entity</code> 部分的程式碼。</p><div class="sourceCode" id="cb1"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">use</span> Doctrine\<span class="kw">ORM</span>\Mapping <span class="kw">as</span> <span class="kw">ORM</span><span class="ot">;</span></span><span id="cb1-2"><a href="#cb1-2"></a>    </span><span id="cb1-3"><a href="#cb1-3"></a>    <span class="co">/**</span></span><span id="cb1-4"><a href="#cb1-4"></a><span class="co">     * </span><span class="an">@ORM\Entity</span></span><span id="cb1-5"><a href="#cb1-5"></a><span class="co">     * </span><span class="an">@ORM\Table(name=&quot;products&quot;)</span></span><span id="cb1-6"><a href="#cb1-6"></a><span class="co">     */</span></span><span id="cb1-7"><a href="#cb1-7"></a>    <span class="kw">class</span> Product</span><span id="cb1-8"><a href="#cb1-8"></a>    {</span><span id="cb1-9"><a href="#cb1-9"></a>        <span class="co">/** </span></span><span id="cb1-10"><a href="#cb1-10"></a><span class="co">         * </span><span class="an">@ORM\Id</span></span><span id="cb1-11"><a href="#cb1-11"></a><span class="co">         * </span><span class="an">@ORM\Column(type=&quot;integer&quot;)</span></span><span id="cb1-12"><a href="#cb1-12"></a><span class="co">         * </span><span class="an">@ORM\GeneratedValue</span></span><span id="cb1-13"><a href="#cb1-13"></a><span class="co">         */</span></span><span id="cb1-14"><a href="#cb1-14"></a>        <span class="kw">protected</span> <span class="kw">$id</span><span class="ot">;</span></span><span id="cb1-15"><a href="#cb1-15"></a>        <span class="co">/** </span></span><span id="cb1-16"><a href="#cb1-16"></a><span class="co">         * </span><span class="an">@ORM\Column(type=&quot;string&quot;)</span><span class="co"> </span></span><span id="cb1-17"><a href="#cb1-17"></a><span class="co">         */</span></span><span id="cb1-18"><a href="#cb1-18"></a>        <span class="kw">protected</span> <span class="kw">$name</span><span class="ot">;</span></span><span id="cb1-19"><a href="#cb1-19"></a>    </span><span id="cb1-20"><a href="#cb1-20"></a>        <span class="co">// .. (other code)</span></span><span id="cb1-21"><a href="#cb1-21"></a>    }</span></code></pre></div><p>這是一個定義 <code>Entity</code> 的 PHP 程式碼， <code>Entity</code> 就如同 Laravel 裡面的 <code>Model</code> 一樣，被視為對照到資料庫的一個資料表的物件，然而一直使我不能明白的是，上述的註解為什麼是有 <strong>功能</strong> 的，而並非只是一個單純的註解，包含了 <code>@ORM\Entity</code> 、 <code>@ORM\Table(name="products")</code> 等等</p><p>要是不設定這些參數的話，便無法使用 Doctrine ，換言之，這些註解並非是提供給開發者看的註解而已，而是實際影響程式運作的程式碼。</p><h2 id="何謂-annotation-reflection">何謂 Annotation &amp; Reflection</h2><blockquote><p>我的解讀： Annotation 是一種語法設計，用以將註解的 PHPDoc，裡面所設置的 meta-data(通常是 class )自動代理與處理其指定的物件或其 property , method 的一種設計</p></blockquote><p>後來看到 Doctrine 官方說明後，了解到由於 PHP 本身並沒有提供 Annotation 的實作，所以 Doctrine 開發一個 Component(Library) 來實作這一部分，然而這不足以讓我明白 <strong>為什麼註解解變成了程式碼</strong>，到底是用了什麼魔法才使 PHP 可以執行到註解裡面的程式？，然而這個問題後來被擱在一旁，也就忘記繼續了解。</p><p>一直到後來接觸 Laravel ，想要了解 Laravel 的 Dependency Injection 機制之後，才發現原來 PHP 有個叫做 <code>Reflection</code> 的 API 和相關物件可以使用，這便是 <strong>為什麼註解解變成了程式碼</strong> 的真正原因，這個原因就是：</p><blockquote><p>使用 PHP Reflection 便可以讀取到物件中的註解，從而實作 PHP Annotation</p></blockquote><p>這同時也是 Doctrine 和 Laravel 實作依賴注入所使用到的方法。</p><h2 id="實作-php-annotation">實作 PHP Annotation</h2><p>那麼，Reflection 又可以做什麼呢？Reflection 是一個可以在執行階段時，取得 以類別名稱為參數，並取得該類別自身的 property 和 Method 、甚至是註解的一種物件。</p><p>這裡簡單實作一個例子，我們在一個類別 <code>Foo</code> 裡面的 private property 定義一個 Annotation ，並搭配使用 Annotation 將其實體化出來。</p><div class="sourceCode" id="cb2"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">class</span> Foo</span><span id="cb2-2"><a href="#cb2-2"></a>{</span><span id="cb2-3"><a href="#cb2-3"></a>    <span class="co">/**</span></span><span id="cb2-4"><a href="#cb2-4"></a><span class="co">    * </span><span class="an">@MyAnnotation(myProperty=&quot;value&quot;)</span></span><span id="cb2-5"><a href="#cb2-5"></a><span class="co">    */</span></span><span id="cb2-6"><a href="#cb2-6"></a>    <span class="kw">private</span> <span class="kw">$bar</span><span class="ot">;</span></span><span id="cb2-7"><a href="#cb2-7"></a>}</span><span id="cb2-8"><a href="#cb2-8"></a>    </span><span id="cb2-9"><a href="#cb2-9"></a><span class="kw">$reflectionClass</span> = <span class="kw">new</span> <span class="kw">ReflectionClass</span><span class="ot">(</span>Foo::<span class="kw">class</span><span class="ot">);</span></span><span id="cb2-10"><a href="#cb2-10"></a><span class="kw">$property</span> = <span class="kw">$reflectionClass</span>-&gt;getProperty<span class="ot">(</span><span class="st">&#39;bar&#39;</span><span class="ot">);</span></span><span id="cb2-11"><a href="#cb2-11"></a><span class="fu">var_dump</span><span class="ot">(</span><span class="kw">$property</span>-&gt;getDocComment<span class="ot">());</span></span></code></pre></div><p>這裏 <code>var_dump</code> 出來所顯示的是一個字串，其值如下：</p><div class="sourceCode" id="cb3"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">/**</span></span><span id="cb3-2"><a href="#cb3-2"></a><span class="co">* </span><span class="an">@MyAnnotation(myProperty=&quot;value&quot;)</span></span><span id="cb3-3"><a href="#cb3-3"></a><span class="co">*/</span></span></code></pre></div><p>再來是要解析這一段註解，這裏我們為方便，直接使用 Doctrine 的 Library <code>AnnotationReader</code> 來協助我們解析。</p><div class="sourceCode" id="cb4"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">&lt;?</span></span><span id="cb4-2"><a href="#cb4-2"></a><span class="kw">require</span> <span class="kw">__DIR__</span> . <span class="st">&#39;/vendor/autoload.php&#39;</span><span class="ot">;</span></span><span id="cb4-3"><a href="#cb4-3"></a></span><span id="cb4-4"><a href="#cb4-4"></a><span class="kw">use</span> Doctrine\Common\Annotations\AnnotationReader<span class="ot">;</span></span><span id="cb4-5"><a href="#cb4-5"></a></span><span id="cb4-6"><a href="#cb4-6"></a><span class="kw">class</span> Foo</span><span id="cb4-7"><a href="#cb4-7"></a>{</span><span id="cb4-8"><a href="#cb4-8"></a>    <span class="co">/**</span></span><span id="cb4-9"><a href="#cb4-9"></a><span class="co">     * </span><span class="an">@MyAnnotation(myProperty=&quot;value&quot;)</span></span><span id="cb4-10"><a href="#cb4-10"></a><span class="co">     */</span></span><span id="cb4-11"><a href="#cb4-11"></a>    <span class="kw">private</span> <span class="kw">$bar</span><span class="ot">;</span></span><span id="cb4-12"><a href="#cb4-12"></a>}</span><span id="cb4-13"><a href="#cb4-13"></a></span><span id="cb4-14"><a href="#cb4-14"></a><span class="co">/**</span></span><span id="cb4-15"><a href="#cb4-15"></a><span class="co"> * </span><span class="an">@Annotation</span></span><span id="cb4-16"><a href="#cb4-16"></a><span class="co"> */</span></span><span id="cb4-17"><a href="#cb4-17"></a><span class="kw">final</span> <span class="kw">class</span> MyAnnotation</span><span id="cb4-18"><a href="#cb4-18"></a>{</span><span id="cb4-19"><a href="#cb4-19"></a>    <span class="kw">public</span> <span class="kw">$myProperty</span><span class="ot">;</span></span><span id="cb4-20"><a href="#cb4-20"></a>}</span><span id="cb4-21"><a href="#cb4-21"></a></span><span id="cb4-22"><a href="#cb4-22"></a><span class="kw">$reflectionClass</span> = <span class="kw">new</span> <span class="kw">ReflectionClass</span><span class="ot">(</span>Foo::<span class="kw">class</span><span class="ot">);</span></span><span id="cb4-23"><a href="#cb4-23"></a><span class="kw">$property</span> = <span class="kw">$reflectionClass</span>-&gt;getProperty<span class="ot">(</span><span class="st">&#39;bar&#39;</span><span class="ot">);</span></span><span id="cb4-24"><a href="#cb4-24"></a></span><span id="cb4-25"><a href="#cb4-25"></a><span class="fu">var_dump</span><span class="ot">(</span><span class="kw">$property</span>-&gt;getDocComment<span class="ot">());</span></span><span id="cb4-26"><a href="#cb4-26"></a><span class="kw">$reader</span> = <span class="kw">new</span> AnnotationReader<span class="ot">();</span></span><span id="cb4-27"><a href="#cb4-27"></a></span><span id="cb4-28"><a href="#cb4-28"></a><span class="kw">$myAnnotation</span> = <span class="kw">$reader</span>-&gt;getPropertyAnnotation<span class="ot">(</span></span><span id="cb4-29"><a href="#cb4-29"></a>    <span class="kw">$property</span><span class="ot">,</span></span><span id="cb4-30"><a href="#cb4-30"></a>    MyAnnotation::<span class="kw">class</span></span><span id="cb4-31"><a href="#cb4-31"></a><span class="ot">);</span></span><span id="cb4-32"><a href="#cb4-32"></a></span><span id="cb4-33"><a href="#cb4-33"></a><span class="fu">var_dump</span><span class="ot">(</span><span class="kw">$myAnnotation</span><span class="ot">);</span></span></code></pre></div><p>這段程式碼的流程主要是這樣</p><ul><li>建立 ReflectionClass 物件，並指向 <code>Foo</code> 這個物件宣告所在的位置。</li><li>然後利用 ReflectionClass 讀取指定名稱的屬性 <code>bar</code> ，還可以取出 <code>bar</code> 的 PHP Doc</li><li>印出 <code>bar</code> 的 Doc</li><li>再搭配 Doctrine 的 <code>AnnotationReader</code> ，呼叫 <code>getPropertyAnnotation</code> 去讀取屬性並且將此屬性的 PHP Doc 與其指向的類別和指定 property value 設定好之後，實體化出來。</li><li>印出 <code>$myAnnotation</code></li></ul><h5 id="補充">補充：</h5><p>在 Reflection 的幫助下便可實作到以下幾個設計</p><ul><li>PHP Annotation</li><li>Dependency Injection</li><li>Aspect Oriented Programming(AOP)：<a href="https://hyperf.wiki/#/zh-cn/aop" target="_blank" rel="noopener">可參考 Hyperf Framework 的 AOP</a></li></ul><p>或許有了 Reflection 可能還可以做到更多功能，本篇並非要完全理解 Reflection ，而是理解如何實作 Annotation 以及 Laravel 的 DI 為目的而已</p><h5 id="參考文獻">參考文獻</h5><ul><li><a href="https://php-annotations.readthedocs.io/en/latest/UsingAnnotations.html" target="_blank" rel="noopener">Understanding annotations</a></li><li><a href="https://www.doctrine-project.org/projects/doctrine-annotations/en/1.6/index.html" target="_blank" rel="noopener">Doctrine Annotation</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
